# Code setup

## Server

After [installing](installation) you can start setting upp your app router on your server

import { Steps, Tabs, Tab } from "nextra-theme-docs";

<Steps>

### Initialize TSDL

```ts filename="server.ts" copy
import { createTSDL } from "@tsdl/server";

export const tsdl = createTSDL(() => undefined);

const fruit = ["banana", "apple", "orange"];
const router = tsdl.router({
  food: tsdl.router({
    fetchFruit: tsdl.query(() => fruit),
  }),
});

export type Router = typeof router;
```

### Add HTTP capabilities

<Tabs items={["Vanilla (Node.JS)", "express.js", "koa"]}>

  <Tab>
    ```shell
    npm i @tsdl/node
    pnpm add @tsdl/node
    yarn add @tsdl/node
    ```

    ```ts {2-3,6-9,20-36} filename="server.ts" copy
    import { createTSDL } from "@tsdl/server";
    import http from "node:http";
    import { nodeTSDL } from "@tsdl/node";

    // A base context is created for each query
    const tsdl = createTSDL((ctx: {
      req: http.IncomingMessage;
      res: http.ServerResponse<http.IncomingMessage>;
    }) => ctx);

    const fruit = ["banana", "apple", "orange"];
    const router = tsdl.router({
      food: tsdl.router({
        fetchFruit: tsdl.query(() => fruit),
      }),
    });

    export type Router = typeof router;

    const requestListener = (
      req: http.IncomingMessage,
      res: http.ServerResponse<http.IncomingMessage>
    ) => {
      if (req.url?.startsWith("/tsdl")) {
        return nodeTSDL(
          router,
          { req, res }, // the arg needed to create a context
          req,
          res
        );
      }
    };

    const server = http.createServer(requestListener);

    server.listen(8000);
    ```

  </Tab>
  
  <Tab>

    ```shell
    npm i @tsdl/express
    pnpm add @tsdl/express
    yarn add @tsdl/express
      ```

    ```ts filename="server.ts" {2-3,6-8,21-26}
    import { createTSDL } from "@tsdl/server";
    import { expressTSDL } from "@tsdl/express";
    import express from "express";

    // A base context is created for each query
    const tsdl = createTSDL(
      (ctx: { req: express.Request; res: express.Response }) => ctx
    );

    const fruit = ["banana", "apple", "orange"];
    const router = tsdl.router({
      food: tsdl.router({
        fetchFruit: tsdl.query(() => fruit),
      }),
    });

    export type Router = typeof router;

    const server = http.createServer(requestListener);

    const app = express()
      .use(
        "/tsdl",
        expressTSDL(router, (req, res) => ({ req, res }))
      )
      .listen(8000);
    ```

  </Tab>

</Tabs>

</Steps>
